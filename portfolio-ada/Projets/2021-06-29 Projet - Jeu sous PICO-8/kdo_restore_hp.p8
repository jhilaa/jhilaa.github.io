pico-8 cartridge // http://www.pico-8.com
version 32
__lua__
--programme principale
function _init()
	frameindex,timer=1,0
	sprites={
		{
		 sprite="bea",
			frames=	{
			 	{x=0,y=0,w=12,h=15,xo=2,dxo=0,yo=0,dyo=1,flipx=false},
					{x=12,y=0,w=12,h=16,xo=2,dxo=1,yo=0,dyo=0,flipx=false},
					{x=23,y=0,w=12,h=16,xo=2,dxo=1,yo=0,dyo=0,flipx=false},
					{x=34,y=0,w=12,h=15,xo=2,dxo=0,yo=0,dyo=1,flipx=false},
					{x=46,y=0,w=12,h=16,xo=2,dxo=1,yo=0,dyo=0,flipx=false},
					{x=57,y=0,w=12,h=16,xo=2,dxo=1,yo=0,dyo=0,flipx=false}
				},
				ismoving=true
		},
		{sprite="julien",
			frames=	{
					{x=0,y=16,w=12,h=15,xo=-10,dxo=0,yo=0,dyo=1,flipx=false},
			 	{x=12,y=16,w=12,h=16,xo=-10,dxo=1,yo=0,dyo=0,flipx=false},
					{x=23,y=16,w=12,h=16,xo=-10,dxo=1,yo=0,dyo=0,flipx=false},
					{x=34,y=16,w=12,h=15,xo=-10,dxo=0,yo=0,dyo=1,flipx=false},
					{x=46,y=16,w=12,h=16,xo=-10,dxo=1,yo=0,dyo=0,flipx=false},
					{x=57,y=16,w=12,h=16,xo=-10,dxo=1,yo=0,dyo=0,flipx=false}
				},
				ismoving=true
		}
	}
	
	init_text()
	--
	create_bougie()
end

--------------------------
function _update60()
	anim_bougie()
	-- increment timer and loop back to 0 every 6 frames
	timer=(timer+1)%6
	if (ismoving and timer==0 ) 
	   or (not ismoving and timer==0 and frameindex>1)
	then 
		frameindex=(frameindex)%6+1
	end
	--
	ismoving = btn(➡️) or btn(⬅️) or btn(⬆️) or btn(⬇️)
	if btn(➡️) 
	 then 
	 	for spr in all(sprites) do
	 		for frame in all(spr.frames) do
		 		frame.xo+=1
		 		frame.flipx=false
		 	end
	 	end
	end 
	--
	if btn(⬅️) 
	 then 
	 	for spr in all(sprites) do
	 		for frame in all(spr.frames) do
		 		frame.xo-=1
		 		frame.flipx=true
		 	end
	 	end
	end
		--
	if btn(⬇️) 
	 then 
	 	for spr in all(sprites) do
	 		for frame in all(spr.frames) do
		 		frame.yo+=1
		 		frame.flipx=false
		 	end
	 	end
	end
	--
			--
	if btn(⬆️) 
	 then 
	 	for spr in all(sprites) do
	 		for frame in all(spr.frames) do
		 		frame.yo-=1
		 		frame.flipx=true
		 	end
	 	end
	end
end

function _draw()
	cls()
	draw_map()
	draw_text()
	draw_bougie()
	--
	for spr in all(sprites) do
		fr=spr.frames[frameindex]
		sspr(fr.x,fr.y,fr.w,fr.h,56+fr.xo,56+fr.yo,fr.w,fr.h,fr.flipx)
	end
	--
	update_camera(sprites[1].frames[frameindex])
end
-->8
--texte et panneau
function init_text()
	text={}
	text.active=true
	text.str={}
	text.str={"hello","ca va?"}
end

function draw_text()
local x=20
local y=48
local w=108
local h=80

	--draw text box
	rectfill(x-1,y-2,w+2,h+2,5)
	rectfill(x,y,w,h,6)

	--write text
	for i=1,#text.str do
	
		local txt=text.str[i]
		local tx=x+1
		local ty=y-5+(i*6)
	
		print (txt,tx,ty,5)
	end
end


-->8
--map et camera

function draw_map()
	map(0,0,0,0,128,64)
end

function check_flag(flag,x,y)
		local sprite=mget(x,y)
		return fget(sprite,flag)
end

function update_camera(frame)
 camx=flr((1+(frame.xo+54))/128)
	camx=mid(0,camx,camx)
	camy=flr((1+(frame.yo+54))/128)
	camy=mid(0,camy,camy)
--	camx=mid(0,flr(64%sprite.xo)*64)
	--camx=flr((1+(sprite.xo-54))/128)*64
 --camy=mid(0,sprite.yo,128)
	camera(camx*128,camy*128)
end

--function update_camera_section(sprite)
--	camx=flr(sprite.xo/16)*16
--	camy=flr(sprite.xo/16)*16
--	camera(camx*8,camy*8)
--end
-->8
--animation bougie
bougie_anim_time=0
bougie_anim_wait=0.05

bougies_sprite={65,67,69,67}
bougie_index=1
bougie_anim_time=time()
bougie_anim_wait=0.1

function create_bougie()
	bougie={x=10,y=10,sprite=65}
end

function draw_bougie()
	spr(bougie.sprite,111,3,2,2)
end

function anim_bougie()
	if time()-bougie_anim_time>bougie_anim_wait then
		bougie.sprite=bougies_sprite[bougie_index]
		bougie_anim_time=time()
		--
		bougie_index+=1
		if bougie_index>count(bougies_sprite) then
			bougie_index=1
		end
	end
end



__gfx__
00000000000000442000000004220000000024200000000024200000000244000000002220000000000000000000000000000000000000000000000000000000
00000000000002444240000024442400000244424000000444424000002444240000022444400000000eeee000eeee0000000000000000000000000000000000
0070070000002424462400044244624000242446240000242446240002244464200044244644000000e8888e0e8677e000000000000000000000000000000000
000770000000224242520002242425200022424252000042424252000242244520002242425400000e888888e888877e0000eeee0eeee0000000000000000000
000770000000224461e2000224461e2000224461e20000224461e2000422461e2000224460e200000e8888888888887e000ee888e8877e0000000eee00eee000
00700700000442f47df000242f47df000042f47df0000242f47df000242f47df000242f47df000000e8888888888887e000e8888888887e00000ee88ee887e00
000000000004222effe0004442effe0004452effe00044422effe0004442effe0004442effe000000ee88888888888ee000e8888888887e00000e88888888e00
0000000000222499200000422944000004229440000044299920000044292200004442944000000000e88888888888e0000ee88888888ee00000e88888888e00
0000000000044949920000004994000000099940000002992994000004999200000449944000000000ee888888888ee00000e88888888e000000ee888888ee00
0000000000e4494999ef000449990000000994900000fe9499944900029929000000099490000000000ee8888888ee000000ee888888ee0000000ee8888ee000
0000000000fe011119ff000114992000000994400000ff04444499000994990000000999200000000000ee88888ee00000000ee8888ee000000000ee88ee0000
000000000000011111000001111ef000000fe41110000001111100000f91112000000111f110000000000ee888ee0000000000ee88ee00000000000eeee00000
00000000000d1111111100d2111ff000000ffd11100001111111dd001ff111200000011ff1100000000000ee8ee000000000000eeee0000000000000ee000000
000000000006dd10011d006d1111100000011dd100000d111002d6001111110000000151110000000000000eee00000000000000ee0000000000000000000000
0000000000006d0001d000d60011000000011160000000d1000d6000d1002d00000001dd10000000000000000000000000000000000000000000000000000000
000000000000000000000000001dd0000001dd0000000000000000000000d66000000d1100000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000009008008000000000000000000000000000000000000
00000000000000444440000004444400000044444000000044442000000244440000004444400000000006776776770000000080090000000000000000000000
00000000000004444444000044444440000444444400000444442000002444442000004444440000008006776776770000000060060000000000000000000000
00000000000004424252000044242520000442425200000442425200004224454000044242540000006076776777870000080767767760000000000000000000
000000000000044461f0000044461f0000044461f20000024461f0000022461f0000044460f20000006777777888470000067767767776000000000000000000
00000000000004f47df000004f47df000004f47df0000002f47df000002f47df000002f47df0000000677788884447000006777777444700000000ee00ee0000
000000000000006ff440000002ff440000002ff4400000022ff440000002ff440000002ff44000000777888444999700007677744499970000000eeeeee7e000
000000000000067760000000577600000000776000000067776000000067770000000677701000000788844499944700077774449994470000000e888888e000
0000000000006767760000006776000000067770000006776776000000777600000007776000000007444499994e870007444499994e870000000ee8888ee000
0000000000f6676777f0000077770000000677700000ff7677766700067767000000067670000000074999944888e700074999944888e700000000ee88ee0000
0000000000ff011117ff000016776000000766700000ff06677677000776770000000177600000000799448888e447000799448888e447000000000eeee00000
0000000000000111110000011116f000000ff61110000001111100000f71116000000111f1100000074488e444777000074488e44477700000000000ee000000
00000000000d1111111100dd111ff000000ffd11100001111111dd001ff111600000011ff11000000788e444777000000788e444777000000000000000000000
000000000006dd10011d006d1111100000011dd100000d111002d600111111000000015111000000074447777000000007444777700000000000000000000000
0000000000006d0001d000d60011000000011160000000d1000d6000d1002d00000001dd10000000077777000000000007777700000000000000000000000000
000000000000000000000000001dd0000001dd0000000000000000000000d66000000d1100000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000900009000000000000008000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000800008000000000000009009000000000000080000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000600806000800000000007008000000000000090900000
00000000000000000000000800000000000000080000000000000000800000000000000000000000000600946400900000003007007000000000030070800000
000000000000000000000008a0000000000000089000000000000008a00000000000000000000000000644676e4460000003b307007000000000333070700000
00000000000000000000008990000000000000a880000000000000a98000000000000000000000000046776d7777640000088807007000000000888070700000
0000000000000000000000888000000000000097800000000000009a0000000000000000000000000476746444476740008788872f700000000887887f700000
00000000000000000000000a00000000000000090000000000000008000000000000000000000000047647677764674000888887ff7f5000000888887f7f5000
0000000000000000000000777000000000000077700000000000007770000000000000000000000047e7746444476774000888f7cf7fc000005f888f7ffff500
000000000000000000000077700000000000007770000000000000777000000000000000000000004477d76e7777674400fffcf7fffff50005f2ffffcffffc00
000000000000000000000077700000000000007770000000000000777000000000000000000000004947776777e7749405f2ffff2ff2f50005fffffffff2ff50
000000000000000000000077700000000000007770000000000000777000000000000000000000004994477d777449940577ffcffff77500057ffcf26777f700
0000000000000000000000777000000000000077700000000000007770000000000000000000000004999444444999400547777f777745000027777744447000
00000000000000000000007770000000000000777000000000000077700000000000000000000000004999999999940000544477744450000004444444444000
00000000000000000000006770000000000000677000000000000067700000000000000000000000000449999994400000054444444550000004444444444000
00000000000000000000006770000000000000677000000000000067700000000000000000000000000004444440000000005444445500000000444444440000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333733333333333a33333cccccccc45cccccc44444444554444444444444444444455000000000000000000000000000000000000000000000000
33333333333337a73333333b3a9a3333cccccccc45cccccc45555555554444444444444444444455000000000000000000000000000000000000000000000000
3333333333333373333333bb33a33333cccccccc45cccccc45cccccc554444444444444444444455000000000000000000000000000000000000000000000000
333333333333333333333bb333333333cccccccc45cccccc45cccccc554444444444444444444455000000000000000000000000000000000000000000000000
3333333333333333b3333b3333333a33cccccccc45cccccc45cccccc554444444444444444444455000000000000000000000000000000000000000000000000
3333333333733333bb3333333333a9a3cccccccc45cccccc45cccccc554444444444444444444455000000000000000000000000000000000000000000000000
3333333337a733333bb3333333333a33cccccccc45cccccc45cccccc554444444444444444444455000000000000000000000000000000000000000000000000
333333333373333333b3333333333333cccccccc45cccccc45cccccc554444444444444444444455000000000000000000000000000000000000000000000000
cccccc54cccccccc444444444444444445cccccccccccc5400000000554444444444444444444455000000000000000000000000000000000000000000000000
cccccc54cccccccc555555555555555445cccccccccccc5400000000554444444444444444444455000000000000000000000000000000000000000000000000
cccccc54cccccccccccccccccccccc5445cccccccccccc5400000000554444444444444444444455000000000000000000000000000000000000000000000000
cccccc54cccccccccccccccccccccc5445cccccccccccc5400000000554444444444444444444455000000000000000000000000000000000000000000000000
cccccc54cccccccccccccccccccccc5445cccccccccccc5400000000554444444444444444444455000000000000000000000000000000000000000000000000
cccccc54cccccccccccccccccccccc5445cccccccccccc5400000000554444444444444444444455000000000000000000000000000000000000000000000000
cccccc5455555555cccccccccccccc54455555555555555400000000554444444444444444444455000000000000000000000000000000000000000000000000
cccccc5444444444cccccccccccccc54444444444444444400000000554444444444444444444455000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000755557000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777758857777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
75555555555555570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
75766676766767570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
75767666676677570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
75555555555555570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777777777777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000077770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000077770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000077770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000077770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000077770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000077770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
